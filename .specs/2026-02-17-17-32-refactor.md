---
tinySpec: v0
title: Refactor
---

# Background

The CLI has a single `spec.rs` file (750 lines) containing 6 distinct functional areas: spec discovery, config management, markdown formatting, validation, core commands, and skill templates. This makes navigation difficult, changes risky due to tangled concerns, and individual pieces hard to test in isolation.

# Proposal

Split `spec.rs` into a module directory (`src/spec/`) with focused submodules, and externalize skill templates to standalone Markdown files loaded via `include_str!()`. Keep `main.rs` unchanged — all public API signatures stay the same.

Target structure:

```
src/
├── main.rs              (unchanged)
├── spec/
│   ├── mod.rs           (shared helpers + re-exports)
│   ├── config.rs        (Config struct + config operations)
│   ├── format.rs        (markdown formatting)
│   ├── init.rs          (init + include_str! for skills)
│   └── commands.rs      (all spec commands)
└── skills/
    ├── tinyspec-refine.md
    ├── tinyspec-work.md
    └── tinyspec-task.md
```

# Implementation Plan

- [x] A: Externalize skill templates to `src/skills/`
- [x] A.1: Create `src/skills/tinyspec-refine.md`
- [x] A.2: Create `src/skills/tinyspec-work.md`
- [x] A.3: Create `src/skills/tinyspec-task.md`
- [x] B: Create spec module directory
- [x] B.1: Create `src/spec/mod.rs` — shared helpers (`specs_dir`, `extract_spec_name`, `find_spec`, `complete_spec_names`, `FrontMatter`, `parse_front_matter`, `validate_kebab_case`) + re-exports from submodules
- [x] B.2: Create `src/spec/config.rs` — `Config`, `config_path`, `load_config`, `save_config`, `config_set`, `config_list`, `config_remove`
- [x] B.3: Create `src/spec/format.rs` — `split_front_matter`, `format_markdown`, `format_file`, `format_spec`, `format_all_specs`
- [x] B.4: Create `src/spec/init.rs` — `init` function + `include_str!()` for skill templates
- [x] B.5: Create `src/spec/commands.rs` — `new_spec`, `list`, `view`, `edit`, `delete`, `check_task`, `status`, `print_status`
- [x] C: Cleanup and verify
- [x] C.1: Remove old `src/spec.rs`
- [x] C.2: Verify `cargo build` succeeds with no warnings
- [x] C.3: Run `cargo test` to confirm integration tests pass

# Test Plan
